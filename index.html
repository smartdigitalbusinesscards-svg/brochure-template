<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Digital Brochure</title>

  <!-- Shared styles (global) -->
  <link rel="stylesheet" href="shared.css" />

  <!-- If JS is blocked, at least show something readable -->
  <noscript>
    <style>
      .jsOnly{ display:none !important; }
      .noJs{ display:block !important; }
    </style>
  </noscript>
</head>

<body>
  <div class="water" aria-hidden="true"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="kicker" id="kicker">Company</div>
        <h1 id="titleH1">Offer Title</h1>
      </div>

      <div class="badgeRow" id="badgeRow" aria-label="Highlights"></div>
    </header>

    <div class="grid">
      <!-- BROCHURE IMAGE CARD -->
      <section class="card imgCard">
        <button class="imgBtn jsOnly" id="openModal" type="button" aria-label="Open brochure image">
          <img id="brochureImg" src="brochure.png" alt="Brochure" />
        </button>

        <!-- Fallback for no-js -->
        <div class="noJs" style="display:none;">
          <img id="brochureImgNoJs" src="brochure.png" alt="Brochure" />
        </div>

        <div class="imgHint">
          <span class="dot" aria-hidden="true"></span>
          <span id="imgHintText">Tap the brochure to zoom in.</span>
        </div>
      </section>

      <!-- DETAILS CARD -->
      <section class="card infoCard">
        <div class="priceRow">
          <div>
            <div class="priceLabel" id="priceLabel">Total Price</div>
            <div class="priceValue" id="priceValue">$0</div>
          </div>
          <div class="pill" id="priceNote">One-time total</div>
        </div>

        <ul id="featureList" aria-label="Included features"></ul>

        <div class="ctaRow" id="ctaRow">
          <!-- CTA (optional by tier) -->
          <a class="btn primary jsOnly" href="#" id="viewBtn">View Brochure</a>

          <!-- Contact buttons -->
          <a class="btn jsOnly" href="#" id="textBtn">Text</a>
          <a class="btn jsOnly" href="#" id="callBtn">Call</a>
          <a class="btn jsOnly" href="#" id="webBtn" target="_blank" rel="noopener">Website</a>

          <!-- No-JS fallback -->
          <div class="noJs" style="display:none;">
            <a class="btn primary" href="brochure.png" target="_blank" rel="noopener">View Brochure</a>
          </div>
        </div>
      </section>
    </div>

    <footer>
      <div class="pill" id="footerPill">Send this link to your referral partner — mobile friendly</div>
      <div id="footerRight">© <span id="year"></span> Company</div>
    </footer>

    <div class="watermark" id="watermark">Installed by Company</div>
  </div>

  <!-- MODAL -->
  <div class="modal jsOnly" id="modal" role="dialog" aria-modal="true" aria-label="Brochure preview">
    <div class="modalInner">
      <img class="modalImg" src="brochure.png" id="modalImg" alt="Brochure enlarged view" />
      <button class="modalClose" type="button" id="modalClose" aria-label="Close brochure preview">✕</button>
    </div>
  </div>

  <!-- Config (Make edits this file per customer) -->
  <script src="config.js"></script>

  <!-- Page logic -->
  <script>
    (function () {
      const cfg = (window.BROCHURE_CONFIG || {});
      const safeStr = (v, fallback="") => (typeof v === "string" && v.trim()) ? v.trim() : fallback;

      // ---- tier normalize
      const tier = safeStr(cfg.tier, "starter").toLowerCase();
      const TIER = (tier === "pro" || tier === "elite") ? tier : "starter";

      // ---- brand
      const company  = safeStr(cfg.brand?.company, "Select Source Water");
      const product  = safeStr(cfg.brand?.product, "Hygia Whole-Home Filtration + Softener");
      const watermark = safeStr(cfg.brand?.watermark, `Installed by ${company}`);

      // ---- pricing
      const priceLabel = safeStr(cfg.pricing?.label, "Total Price");
      const priceValue = safeStr(cfg.pricing?.value, "$0");
      const priceNote  = safeStr(cfg.pricing?.note, "One-time total");

      // ---- images + CTA label
      const brochureImage = safeStr(cfg.brochureImage, "brochure.png");
      const ctaLabel = safeStr(cfg.cta?.label, "View Brochure");

      // ---- contact
      const rawPhone = safeStr(cfg.contact?.phone, "");
      const website  = safeStr(cfg.contact?.website, "");

      // phone sanitizer: keep digits only, assume US if 10 digits
      const digits = rawPhone.replace(/\D/g, "");
      const phoneForLinks = digits.length === 10 ? ("1" + digits) : digits; // e.g. 1209...
      const telHref = phoneForLinks ? ("tel:+" + phoneForLinks) : null;
      const smsHref = phoneForLinks ? ("sms:+" + phoneForLinks) : null;

      // ---- badges + features
      const badges = Array.isArray(cfg.badges) ? cfg.badges : [];
      const features = Array.isArray(cfg.features) ? cfg.features : [];

      // ---- text injections
      const el = (id) => document.getElementById(id);

      el("kicker").textContent = company;
      el("titleH1").textContent = product;

      document.title = `${company} | ${product}`;

      el("priceLabel").textContent = priceLabel;
      el("priceValue").textContent = priceValue;
      el("priceNote").textContent  = priceNote;

      el("footerRight").innerHTML = `© <span id="year"></span> ${company}`;
      el("year").textContent = String(new Date().getFullYear());

      el("watermark").textContent = watermark;

      // brochure images
      el("brochureImg").src = brochureImage;
      el("brochureImg").alt = `${company} brochure`;
      const noJsImg = el("brochureImgNoJs");
      if (noJsImg) {
        noJsImg.src = brochureImage;
        noJsImg.alt = `${company} brochure`;
      }
      el("modalImg").src = brochureImage;
      el("modalImg").alt = `${company} brochure enlarged`;

      // badges
      const badgeRow = el("badgeRow");
      badgeRow.innerHTML = "";
      badges.forEach(b => {
        const txt = safeStr(b, "");
        if (!txt) return;
        const div = document.createElement("div");
        div.className = "badge";
        div.textContent = txt;
        badgeRow.appendChild(div);
      });

      // features list
      const list = el("featureList");
      list.innerHTML = "";
      features.forEach(f => {
        const txt = safeStr(f, "");
        if (!txt) return;
        const li = document.createElement("li");
        li.innerHTML = `<span class="check" aria-hidden="true">✓</span><span class="liText"></span>`;
        li.querySelector(".liText").textContent = txt;
        list.appendChild(li);
      });

      // CTA rules:
      // - Starter: NO CTA button
      // - Pro: CTA ON (single)
      // - Elite: CTA ON (still single here; your Elite "multiple CTAs" can be a later add-on)
      const ctaEnabledByTier = (TIER === "pro" || TIER === "elite");
      const ctaFlag = (cfg.cta && typeof cfg.cta.enabled === "boolean") ? cfg.cta.enabled : ctaEnabledByTier;
      const showCTA = Boolean(ctaFlag) && ctaEnabledByTier;

      const viewBtn = el("viewBtn");
      viewBtn.textContent = ctaLabel;
      // view button just opens modal
      if (!showCTA) {
        viewBtn.style.display = "none";
      }

      // Contact buttons
      const textBtn = el("textBtn");
      const callBtn = el("callBtn");
      const webBtn  = el("webBtn");

      // If missing phone/website, disable those buttons visually + functionally
      function disableBtn(a){
        a.setAttribute("aria-disabled","true");
        a.style.opacity = "0.45";
        a.style.pointerEvents = "none";
        a.removeAttribute("href");
      }

      if (smsHref) textBtn.href = smsHref; else disableBtn(textBtn);
      if (telHref) callBtn.href = telHref; else disableBtn(callBtn);
      if (website) webBtn.href = website; else disableBtn(webBtn);

      // ---- Modal open/close
      const modal = el("modal");
      const openModalBtn = el("openModal");
      const modalClose = el("modalClose");

      function openModal(){
        modal.classList.add("open");
        document.body.style.overflow = "hidden";
      }
      function closeModal(){
        modal.classList.remove("open");
        document.body.style.overflow = "";
      }

      // open from image
      openModalBtn.addEventListener("click", openModal);

      // open from CTA (if visible)
      viewBtn.addEventListener("click", (e) => { e.preventDefault(); openModal(); });

      // close behaviors
      modal.addEventListener("click", (e) => {
        // close if you click the dark overlay (not the inner)
        if (e.target === modal) closeModal();
      });
      modalClose.addEventListener("click", closeModal);

      // ESC closes
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && modal.classList.contains("open")) closeModal();
      });

      // ---- Price shine once
      const priceEl = el("priceValue");
      window.addEventListener("load", () => {
        priceEl.classList.add("shine-once");
        setTimeout(() => priceEl.classList.remove("shine-once"), 1200);
      });

      // ---- Ripple effect (buttons only)
      function addRipple(e){
        const btn = e.currentTarget;
        if (!btn || btn.getAttribute("aria-disabled") === "true") return;

        const rect = btn.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height) * 2;

        const clientX = (e.touches && e.touches[0]) ? e.touches[0].clientX : e.clientX;
        const clientY = (e.touches && e.touches[0]) ? e.touches[0].clientY : e.clientY;

        const x = clientX - rect.left - size/2;
        const y = clientY - rect.top - size/2;

        const ripple = document.createElement("span");
        ripple.className = "ripple";
        ripple.style.width = ripple.style.height = size + "px";
        ripple.style.left = x + "px";
        ripple.style.top = y + "px";
        btn.appendChild(ripple);
        ripple.addEventListener("animationend", ()=>ripple.remove(), {once:true});
      }

      document.querySelectorAll(".btn").forEach(btn=>{
        btn.addEventListener("click", addRipple);
        btn.addEventListener("touchstart", addRipple, {passive:true});
      });

      // ---- Optional: apply accent colors per config (if provided)
      // cfg.theme = { accent: "#4fe3ff", accent2:"#63ffb2", bgA:"#04151f", bgB:"#0a2f3f" }
      if (cfg.theme) {
        const root = document.documentElement.style;
        if (cfg.theme.accent)  root.setProperty("--accent",  cfg.theme.accent);
        if (cfg.theme.accent2) root.setProperty("--accent2", cfg.theme.accent2);
        if (cfg.theme.bgA)     root.setProperty("--bgA",     cfg.theme.bgA);
        if (cfg.theme.bgB)     root.setProperty("--bgB",     cfg.theme.bgB);
      }
    })();
  </script>

  <!-- SHARED + CONFIG (MUST load after DOM) -->
  <script src="./shared/shared.js"></script>
  <script src="./shared/config.js"></script>

</body>
</html>
